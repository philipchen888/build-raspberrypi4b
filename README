This is to build sdcard image for Raspberrypi4b:

Steps to build raspberrypi4b sdcard image:

1. git clone https://github.com/philipchen888/build-raspberrypi4b.git
   sudo apt-get install build-essential git libssl-dev nmap net-tools libncurses5-dev libncursesw5-dev dnsutils vsftpd ftp binfmt-support qemu-user-static scons libncurses5-dev libncursesw5-dev libdbus-glib-1-dev libbluetooth-dev python-dev python-setuptools python3-dev python3-pip python3-setuptools libcurl4-openssl-dev gettext dbus-x11 chrpath diffstat gawk texinfo curl flex bison device-tree-compiler python swig libmpc-dev

2. Install cross compiler and live-build:
   wget https://releases.linaro.org/components/toolchain/binaries/latest-7/aarch64-linux-gnu/gcc-linaro-7.5.0-2019.12-x86_64_aarch64-linux-gnu.tar.xz
   sudo tar xvf gcc-linaro-7.5.0-2019.12-x86_64_aarch64-linux-gnu.tar.xz  -C /usr/local/
   wget https://releases.linaro.org/components/toolchain/binaries/latest-7/arm-linux-gnueabihf/gcc-linaro-7.5.0-2019.12-x86_64_arm-linux-gnueabihf.tar.xz
   sudo tar xvf gcc-linaro-7.5.0-2019.12-x86_64_arm-linux-gnueabihf.tar.xz -C /usr/local/
   sudo apt-get install debootstrap debhelper kpartx gdisk devscripts dh-systemd isolinux po4a
   #wget https://launchpad.net/debian/+archive/primary/+sourcefiles/live-build/1:20210407/live-build_20210407.tar.xz
   #tar xvf live-build_20210407.tar.xz
   wget https://launchpad.net/debian/+archive/primary/+sourcefiles/live-build/1:20230502/live-build_20230502.tar.xz
   tar xvf live-build_20230502.tar.xz
   cd live-build
   sudo make install

   linux-firmware is in:
   git clone https://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git --depth=1

3. cd ~/build-raspberrypi4b/kernel ( Compile vendor's kernel )
   git clone https://github.com/raspberrypi/linux --depth=1 -b rpi-5.4.y
   cp bcm2711_defconfig ./linux/arch/arm/configs/
   cd linux; mkdir tmp; cd tmp; mkdir lib;
   cd ../../; mkdir out;

   make kernel
   The result is in ./out/boot.img

4. cd ~/build-raspberrypi4b/linux  ( Compile mainline kernel )
   git clone https://github.com/raspberrypi/linux --depth=1 -b rpi-6.1.y
   vi ./linux/arch/arm/configs/bcm2711_defconfig ( change CONFIG_I2C_CHARDEV=m to CONFIG_I2C_CHARDEV=y )
   cd linux; mkdir tmp; cd tmp; mkdir lib;
   cd ../../; mkdir out;

   make kernel
   The result is in ./out/boot.img


5. cd ~/build-raspberrypi4b/rootfs-buster  ( Compile debian buster rootfs )
   make rootfs        ( has desktop )
   The result is in ./linaro-rootfs.img

   make basicrootfs   ( no desktop )
   The result is in ./linaro-basicrootfs.img
   make clean

6. cd ~/build-raspberrypi4b/rootfs-bullseye  ( Compile debian bullseye rootfs )
   make rootfs        ( has desktop )
   The result is in ./linaro-rootfs.img

   make basicrootfs   ( no desktop )
   The result is in ./linaro-basicrootfs.img
   make clean

7. cd ~/build-raspberrypi4b/rootfs-bookworm  ( Compile debian bookworm rootfs )
   make rootfs        ( has desktop )
   The result is in ./linaro-rootfs.img

   make basicrootfs   ( no desktop )
   The result is in ./linaro-basicrootfs.img
   make clean

8. cd ~/build-raspberrypi4b/rootfs-ubuntu-focal  ( Compile debian ubuntu-focal rootfs )
   make rootfs
   The result is in ./linaro-rootfs.img
   make clean

9. cd ~/build-raspberrypi4b/rootfs-ubuntu-jammy  ( Compile debian ubuntu-jammy rootfs )
   make rootfs
   The result is in ./linaro-rootfs.img
   make clean

10. cd ~/build-raspberrypi4b/buster-lxde  ( Build debian buster lxde-desktop image )
    ./mksdcardimg.sh
    The result is in sdcard.img

11. cd ~/build-raspberrypi4b/buster-xfce-kde-gnome ( Build buster xfce-kde-gnome desktop image )
    ./mksdcardimg.sh
    The result is in sdcard.img

12. cd ~/build-raspberrypi4b/bullseye-lxde  ( Build debian bullseye lxde-desktop image )
    ./mksdcardimg.sh
    The result is in sdcard.img

13. cd ~/build-raspberrypi4b/bullseye-xfce-kde-gnome ( Build bullseye xfce-kde-gnome desktop image )
    ./mksdcardimg.sh
    The result is in sdcard.img

14. cd ~/build-raspberrypi4b/bookworm-lxde  ( Build debian bookworm lxde-desktop image )
    ./mksdcardimg.sh
    The result is in sdcard.img

15. cd ~/build-raspberrypi4b/bookworm-xfce-kde-gnome ( Build bookworm xfce-kde-gnome desktop image )
    ./mksdcardimg.sh
    The result is in sdcard.img

16. cd ~/build-raspberrypi4b/ubuntu-focal  ( Build ubuntu-focal image )
    ./mksdcardimg.sh
    The result is in sdcard.img

17. cd ~/build-raspberrypi4b/ubuntu-jammy  ( Build ubuntu-jammy image )
    ./mksdcardimg.sh
    The result is in sdcard.img

18. cd ~/build-raspberrypi4b/yocto  ( Build yocto image )

19. cd ~/build-raspberrypi4b/yocto-lxde  ( Build yocto lxde-desktop image )

20. cd ~/build-raspberrypi4b/yocto-xfce  ( Build yocto xfce-desktop image )

21. cd ~/build-raspberrypi4b/buildroot   ( Build buildroot image )

22. cd ~/build-raspberrypi4b/android     ( Build android image )

23. cd ~/build-raspberrypi4b/bullseye-gpio  ( gpio test in bullseye-lxde )

24. cd ~/build-raspberrypi4b/bullseye-pn532nfc  ( pn532nfc test in bullseye-lxde )

25. cd ~/build-raspberrypi4b/bullseye-flightaware  ( flightaware in bullseye-lxde ) 

26. cd ~/build-raspberrypi4b/baremetal-gpio  ( gpio test in baremetal )
